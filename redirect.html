<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OAuth Redirect</title>
    <link rel="stylesheet" href="vanilla.css">
  </head>
  <body>
    <script>
      // @ts-check

      const p = document.createElement('h2');
      p.append('Signed in. You can now close this tab.');

      document.body.append(p);

      const hash = document.location.hash.slice(1);
      
      // https://stackoverflow.com/a/18804255
      window.addEventListener("message", function(ev) {
        if (ev.data.message === "requestResult") {
          ev.source.postMessage({ message: "deliverResult", result: hash }, {
            targetOrigin: '*'
          });
        }
      });
      
      // this is optional, but after retrieving the parameters, we should ideally
      // scrub it from history to prevent this authorization state to be replayed,
      // just for good measure.
      history.replaceState(null, '', location.pathname + location.search);

      // setTimeout(() => window.close(), 1000);
    </script>
  </body>
</html>
